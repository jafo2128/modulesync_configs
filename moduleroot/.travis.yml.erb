#This file is generated by ModuleSync, do not edit.
---
sudo: false
language: ruby
cache: bundler
script: <%= @configs['script'] %>
#Inserting below due to the following issue: https://github.com/travis-ci/travis-ci/issues/3531#issuecomment-88311203
before_install:
  - gem update bundler
matrix:
  fast_finish: true
  include:
<% if @configs['supported_oss'][@configs[:puppet_module]].include?('linux') -%>
<%   if @configs['docker_sets'] -%>
<%     @configs['docker_sets'].each do |set| -%>
<%       job = @configs['docker_defaults'].merge(set['options'] || {}) -%>
  - rvm: <%= job['rvm'] %>
<%       job.keys.sort.each do |k| -%>
<%       next if k == 'rvm' -%>
    <%= k %>: <%= job[k].gsub(/@@SET@@/, set['set']) %>
<%       end -%>
<%     end -%>
<%   end -%>
<% end -%>
<% @configs['includes'].each do |job| -%>
  - rvm: <%= job['rvm'] %>
<%   job.keys.sort.each do |k| -%>
<%     next if k == 'rvm' -%>
    <%= k %>: <%= job[k] %>
<%   end -%>
<% end -%>
<% if @configs['extras'] -%>
<%   @configs['extras'].each do |job| -%>
  - rvm: <%= job['rvm'] %>
<%     job.keys.sort.each do |k| -%>
<%       next if k == 'rvm' -%>
    <%= k %>: <%= job[k] %>
<%     end -%>
<%   end -%>
<% end -%>
<% if @configs['allow_failures'] -%>
  allow_failures:
<%   @configs['allow_failures'].each do |job| -%>
    - rvm: <%= job['rvm'] %>
<%     job.keys.sort.each do |k| -%>
<%       next if k == 'rvm' -%>
      <%= k %>: <%= job[k] %>
<%     end -%>
<%   end -%>
<% end -%>
deploy:
  - provider: pages
    skip_cleanup: true
    github_token:
      secure: "<%= @configs['github_token'] %>"
    local_dir: doc
    on:
      repo: <%= @configs[:namespace] %>/<%= @configs['module_repos'][@configs[:puppet_module]] %>
      rvm: <%= @configs['includes'][0]['rvm'] %>
      # all_branches is required to use tags
      all_branches: true
      tags: true
  - provider: puppetforge
    user: <%= @configs[:namespace] %>
    password:
      secure: "<%= @configs['puppetforge_password'] %>"
    on:
      repo: <%= @configs[:namespace] %>/<%= @configs['module_repos'][@configs[:puppet_module]] %>
      rvm: <%= @configs['includes'][0]['rvm'] %>
      # all_branches is required to use tags
      all_branches: true
      tags: true
notifications:
  email:
    on_success: change
    on_failure: change
<% if @configs['pushover'] -%>
  pushover:
    users:
<%  @configs['pushover']['users'].each do |user| -%>
      - secure: "<%= user %>"
<%  end -%>
    api_key:
      secure: "<%= @configs['pushover']['api_key'] %>"
<% end -%>
branches:
  except:
  - "/^noci-.*$/"
